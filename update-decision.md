# 문서-코드 정합성 업데이트 의사결정 메모

## 1. 배경
- 최근 리팩토링 이후, 문서(`docs/sections/06_privacy_enhancement_framework.md` 등)와 실제 코드(`src/privacy`, `src/generation`, `src/analysis` 모듈) 사이에 기능 수준 불일치가 다수 확인되었음.
- 주요 문서는 고급 통계 기법과 종합적 프라이버시 통제를 약속하고 있으나, 현재 코드베이스는 단순화된 구현(집계 기반 분포, 로그정규 피팅, 일괄 억제 우선 전략 등)에 머물러 있음.
- 차후 개발 방향(문서 정정 vs 코드 보강)을 결정하기 위해, 현황과 선택지에 대한 정리 문서가 필요함.

## 2. 핵심 불일치 요약
1. **패턴 분석 시스템 (문서 3장 vs `src/analysis/pattern_analyzer.py`)**
   - 문서: KDE, 베타-이항, 로지스틱 회귀, NHPP 등 고급 모델 사용을 명시.
   - 코드: SQL 집계 결과와 계층적 폴백만 제공, 통계 모델/검증 부재.

2. **벡터화 생성기 (문서 4장 vs `src/vectorized/patient_generator.py`)**
   - 문서: 상관 보존(Cholesky), 역누적변환, 다변량 로지스틱 KTAS 모델 언급.
   - 코드: 독립 다항 샘플링 + 패턴 폴백이 전부, 상관 구조 및 추가 설정 파라미터 미구현.

3. **시간 간격 합성 (문서 4.2 vs `src/temporal/*.py`)**
   - 문서: NHPP 기반 도착률, 계절/휴일 효과 반영.
   - 코드: KTAS/결과별 로그정규 분포 추정과 샘플링, 강도함수 미적용.

4. **K-익명성 집행 (문서 6.2 vs `EnhancedSyntheticGenerator._enforce_k_anonymity`)**
   - 문서: 데이터 특성에 따른 자동 하이브리드(억제/일반화) 선택 강조.
   - 코드: 억제를 기본으로 시도 후 억제율이 임계 초과 시 일반화 시도.

5. **L-다양성 및 T-근접성 (문서 6.3 vs `PrivacyValidator`)**
   - 문서: 엔트로피/재귀 다양성, 실제 Earth Mover’s Distance 기반 평가 명시.
   - 코드: 단순 distinct count, L1 거리/2 근사치 사용.

6. **프라이버시 예산 관리 (문서 6.4 vs `DifferentialPrivacy` 및 `PrivacyAccountant`)**
   - 문서: 예산 분할 구조, 순차/병렬/고급 합성 이론 설명.
   - 코드: 단일 ε 누계 추적만 수행, 합성 이론 미반영.

## 3. 선택지 비교
| 선택지 | 장점 | 단점 | 예상 공수 |
|--------|------|------|-----------|
| **A. 문서 현실화** (문서를 현행 코드 기준으로 축소/수정) | - 단기 대응 가능<br>- 향후 독자 혼란 최소화<br>- 구현 복잡도 낮음 | - 고급 기능 미제공 인정 필요<br>- 향후 기능 확장 시 문서 재수정 필요 | 1~2주 (섹션별 재작성 및 리뷰) |
| **B. 코드 보강** (문서 수준 기능을 실제로 구현) | - 문서 일관성 유지<br>- 시스템 경쟁력 및 신뢰도 향상 | - 고난도 통계/프라이버시 기법 구현 필요<br>- 테스트 및 검증 부담 증가 | 6~10주 이상 (모듈별 병행 개발 필요) |
| **C. 단계적 혼합** (단기 문서 수정 + 장기 코드 로드맵) | - 당장 정합성 확보<br>- 중장기 로드맵으로 문서 약속 회복 가능 | - 초기 의사소통/공지 필요<br>- 로드맵 미준수 시 신뢰도 추가 저하 | 문서 대응 1~2주 + 로드맵 수립 1주 + 개발 스프린트 별도 |

> **결정:** 선택지 **C. 단계적 혼합**을 채택한다. 즉시 문서를 현실화하고, 병행하여 고급 기능 구현 로드맵을 수립·추진한다.

## 4. 고려 사항
- **리소스 가용성**: 통계/프라이버시 전문가 투입 가능 여부 확인 필요.
- **규제/컴플라이언스**: 외부 보고 자료라면 과장 표현 즉시 수정 권장.
- **사용자 기대치**: 이미 기능을 의존 중인 파트너가 있는지 파악.
- **테스트 인프라**: 고급 기법 도입 시, 데이터 샘플 및 검증 자동화 체계 필요.

## 5. 권장 의사결정 절차
1. 제품/비즈니스 요구 정렬: 단기적으로 실사용자에게 필요한 기능 수준 정의.
2. 리소스 및 일정 검토: 내부 개발 역량, 외부 협력 가능성 파악.
3. 선택지 결정: **선택지 C(단계적 혼합)** 확정.
   - 단기: 문서 현실화(섹션 3, 4, 6 등)를 1~2주 내 완료하고 CHANGELOG에 기록.
   - 중장기: 분석/생성/프라이버시 모듈별 고급 기능 구현 로드맵을 1주 내 작성 후 분기별 스프린트에 편성.
4. 커뮤니케이션 계획 수립: 문서 변경 또는 로드맵 공지 시 이해관계자와 공유.

## 6. 후속 작업 제안
- **단기 (문서 현실화)**
  - 각 문서 섹션별 실제 구현 내용 기반 재작성 초안 준비.
  - 문서 변경 히스토리 관리(CHANGELOG) 및 외부 공지 초안 마련.
- **중장기 (로드맵 실행)**
  - 모듈별 기능 갭을 세분화한 개발 백로그 생성 (예: KDE 학습기, NHPP 모듈, 고급 k-익명성 엔진 등).
  - 단위/통합 테스트 강화 계획 수립 및 데이터 샘플/벤치마크 확보.
- **공통**
  - 현재 문서가 약속한 기능 리스트를 추적 가능한 항목으로 관리(트래킹 시트 또는 이슈 트래커).

## 7. 결론
- 현 시점에서 문서와 코드 사이의 괴리가 명확하며, 이에 대응하기 위한 전략으로 **선택지 C(단계적 혼합)**을 채택한다.
- 단기적으로는 문서 현실화 작업을 즉시 착수하여 외부 커뮤니케이션 리스크를 최소화한다.
- 중장기적으로는 고급 기능 구현 로드맵을 실행하여 문서에서 약속한 수준을 순차적으로 회복·강화한다.
- 본 계획을 제품/기술 리더십과 공유하고, 진행 상황을 분기별로 리뷰한다.
