<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NEDIS Original vs Synthetic Comparison</title>
    <style>
      body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 16px; }
      h1 { margin: 0 0 8px 0; }
      .meta { color: #666; margin-bottom: 16px; }
      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; }
      .title { font-weight: 600; margin-bottom: 8px; }
      table { width: 100%; border-collapse: collapse; font-size: 12px; }
      th, td { border: 1px solid #eee; padding: 4px 6px; text-align: right; }
      th:first-child, td:first-child { text-align: left; }
      img { max-width: 100%; height: auto; border: 1px solid #eee; border-radius: 4px; }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items: start; }
      .section { margin: 24px 0; }
      .pval { color: #444; font-size: 12px; }
    </style>
  </head>
  <body>
    <h1>NEDIS Original vs Synthetic Comparison</h1>
    <div class="meta">DB: {{ db_path }} | Original sample: {{ orig_count | default(0) }} | Synthetic: {{ syn_count | default(0) }}</div>

    <div class="section">
      <div class="title">Temporal Comparisons</div>
      <div class="row">
        <div class="card">
          <div class="title">Hourly Arrival Distribution</div>
          <img src="data:image/png;base64,{{ hourly_png }}" />
        </div>
        <div class="card">
          <div class="title">Inter-arrival Times (minutes)</div>
          <img src="data:image/png;base64,{{ interarrival_png }}" />
        </div>
      </div>
    </div>

    <div class="section">
      <div class="title">Per-Column Distribution Comparison</div>
      {% for cmp in comparisons %}
        <div class="card">
          <div class="title">{{ cmp.column }}
            {% if cmp.chi_square_p is not none %}
              <span class="pval">(chi-square p = {{ '%.3g' | format(cmp.chi_square_p) }})</span>
            {% endif %}
          </div>
          <div class="row">
            <div>
              <div class="title">Original</div>
              <table>
                <thead><tr><th>Value</th><th>Count</th><th>Proportion</th></tr></thead>
                <tbody>
                  {% for r in cmp.left_table %}
                    <tr>
                      <td>{{ r[cmp.column] }}</td>
                      <td>{{ r['count'] }}</td>
                      <td>{{ '%.3f' | format(r['proportion']) }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div>
              <div class="title">Synthetic</div>
              <table>
                <thead><tr><th>Value</th><th>Count</th><th>Proportion</th></tr></thead>
                <tbody>
                  {% for r in cmp.right_table %}
                    <tr>
                      <td>{{ r[cmp.column] }}</td>
                      <td>{{ r['count'] }}</td>
                      <td>{{ '%.3f' | format(r['proportion']) }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <div style="margin-top:8px;">
            <img src="data:image/png;base64,{{ cmp.chart_png }}" />
          </div>
        </div>
      {% endfor %}
    </div>

  </body>
  </html>

